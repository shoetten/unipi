#!/bin/bash
set -e

###################################################################
# run this after system startup to mount data on external storage #
###################################################################

read -s -p "Enter LUKS password: " lukspassword

echo "\nMount and decrypt external drives.."
{% for name, path in external_drive_paths.items() %}
echo $lukspassword | sudo cryptsetup luksOpen {{ path.external }} {{ name }} -
mkdir -p {{ path.internal }}
sudo mount /dev/mapper/{{ name }} {{ path.internal }}
sudo chmod 755 {{ path.internal }}
echo "\nMounted {{ name }}!"
{% endfor %}

echo "\nRestart relevant docker containers.."
# restart jellyfin
sudo docker restart jellyfin
